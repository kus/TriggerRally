// Generated by CoffeeScript 1.7.1
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  define(['views/view', 'jade!templates/home'], function(View, template) {
    var HomeView;
    return HomeView = (function(_super) {
      __extends(HomeView, _super);

      HomeView.prototype.className = 'overlay';

      HomeView.prototype.template = template;

      function HomeView(app, client) {
        this.app = app;
        this.client = client;
        HomeView.__super__.constructor.call(this);
      }

      HomeView.prototype.initialize = function() {
        return this.listenTo(this.app.root, 'change:user', (function(_this) {
          return function() {
            return _this.render();
          };
        })(this));
      };

      HomeView.prototype.viewModel = function() {
        var _ref;
        return {
          loggedIn: this.app.root.user != null,
          credits: (_ref = this.app.root.user) != null ? _ref.credits : void 0
        };
      };

      HomeView.prototype.afterRender = function() {
        var $userCredits, updateDriveButton, updatePromo;
        (updateDriveButton = (function(_this) {
          return function() {
            var trackId, _ref;
            trackId = (_ref = _this.app.root.track) != null ? _ref.id : void 0;
            if (trackId) {
              return _this.$('.drivebutton').attr('href', "/track/" + trackId + "/drive");
            }
          };
        })(this))();
        this.listenTo(this.app.root, 'change:track.', updateDriveButton);
        $userCredits = this.$('.ca-credit.usercredits');
        this.listenTo(this.app.root, 'change:user.credits', (function(_this) {
          return function() {
            var _ref;
            return $userCredits.text((_ref = _this.app.root.user) != null ? _ref.credits : void 0);
          };
        })(this));
        (updatePromo = (function(_this) {
          return function() {
            var packa, products, _ref, _ref1;
            products = (_ref = (_ref1 = _this.app.root.user) != null ? _ref1.products : void 0) != null ? _ref : [];
            packa = __indexOf.call(products, 'packa') >= 0;
            _this.$('.ignition-promo').toggleClass('hidden', packa || __indexOf.call(products, 'ignition') >= 0);
            return _this.$('.mayhem-promo').toggleClass('hidden', packa || __indexOf.call(products, 'mayhem') >= 0);
          };
        })(this))();
        this.listenTo(this.app.root, 'change:user.products', updatePromo);
        this.$('.purchasebutton a').on('click', (function(_this) {
          return function(event) {
            _this.app.showCreditPurchaseDialog();
            return false;
          };
        })(this));
      };

      return HomeView;

    })(View);
  });

}).call(this);
